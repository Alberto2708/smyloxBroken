<UserControl x:Class="SmyloxFirstUI.View.Patient.PatientInfoView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SmyloxFirstUI.View.Patient"
             xmlns:vmPatient="clr-namespace:SmyloxFirstUI.ViewModel.Patient"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>
        <!-- Colors -->
        <SolidColorBrush x:Key="PrimaryColor" Color="#3B82F6"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#1F2937"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#6B7280"/>
        <SolidColorBrush x:Key="BorderColor" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="BackgroundColor" Color="#F9FAFB"/>

        <!-- Primary Button Style -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Height" Value="40"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.9"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Opacity" Value="0.8"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Back Button Style -->
        <Style x:Key="BackButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <ContentPresenter/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="{StaticResource PrimaryColor}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- GridViewColumnHeader Style -->
        <Style TargetType="GridViewColumnHeader">
            <Setter Property="Background" Value="{StaticResource BackgroundColor}"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
        </Style>

        <!-- ListViewItem Style -->
        <Style TargetType="ListViewItem">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource BackgroundColor}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#EFF6FF"/>
                    <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Background="{StaticResource BackgroundColor}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="0.2*"/>
            <RowDefinition Height="0.3*"/>
            <RowDefinition Height="0.5*"/>
        </Grid.RowDefinitions>

        <!-- Back Button Row -->
        <Button Grid.Row="0"
                Style="{StaticResource BackButton}"
                HorizontalAlignment="Left"
                Margin="24,20,0,10"
                Command="{Binding BackToDashboardCommand}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="&#xE72B;" 
                         FontFamily="Segoe MDL2 Assets"
                         FontSize="16"
                         Margin="0,0,8,0"
                         VerticalAlignment="Center"/>
                <TextBlock Text="Volver al Dashboard" 
                         FontSize="14"
                         FontWeight="Medium"
                         VerticalAlignment="Center"/>
            </StackPanel>
        </Button>

        <!-- Patient Name -->
        <StackPanel Grid.Row="1" 
                   Orientation="Horizontal"
                   Margin="24,10,24,0">
            <Border Width="60"
                   Height="60"
                   Background="{StaticResource PrimaryColor}"
                   CornerRadius="30"
                   Margin="0,0,16,0"
                   VerticalAlignment="Center">
                <TextBlock Foreground="White"
                         FontSize="24"
                         FontWeight="Bold"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center">
                    <Run Text="{Binding PatientInfo.firstName, StringFormat={}{0:1}}"/>
                    <Run Text="{Binding PatientInfo.lastName, StringFormat={}{0:1}}"/>
                </TextBlock>
            </Border>

            <StackPanel VerticalAlignment="Center">
                <TextBlock FontSize="22" 
                         FontWeight="Bold"
                         Foreground="{StaticResource TextPrimary}">
                    <Run Text="{Binding PatientInfo.firstName}"/>
                    <Run Text="{Binding PatientInfo.lastName}"/>
                </TextBlock>
                <TextBlock Text="Información del Paciente"
                         FontSize="13"
                         Foreground="{StaticResource TextSecondary}"
                         Margin="0,4,0,0"/>
            </StackPanel>
        </StackPanel>

        <!-- Create Case Button -->
        <StackPanel Grid.Row="2" 
                   Orientation="Vertical" 
                   Margin="24,10">
            <Grid Margin="0,0,0,12">
                <TextBlock Text="Casos Médicos"
                         FontSize="18"
                         FontWeight="Bold"
                         Foreground="{StaticResource TextPrimary}"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Left"/>

                <Button Style="{StaticResource PrimaryButton}"
                       HorizontalAlignment="Right"
                       VerticalAlignment="Center"
                       Command="{Binding CreateMedicalCaseCommand}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE710;" 
                                 FontFamily="Segoe MDL2 Assets"
                                 FontSize="14"
                                 Margin="0,0,8,0"
                                 VerticalAlignment="Center"/>
                        <TextBlock Text="Crear Caso" 
                                 VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </Grid>
        </StackPanel>

        <!-- Cases List -->
        <Border Grid.Row="3"
               Background="White"
               BorderBrush="{StaticResource BorderColor}"
               BorderThickness="1"
               CornerRadius="12"
               Margin="24,0,24,24">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ListView Name="lvCases" 
                         ItemsSource="{Binding MedicalCasesView}"
                         Background="Transparent"
                         BorderThickness="0">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="ID del Caso" Width="150">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding id}" 
                                                 Foreground="{StaticResource TextPrimary}"
                                                 FontWeight="Medium"
                                                 FontSize="13"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Categoría" Width="300">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding category}" 
                                                 Foreground="{StaticResource TextPrimary}"
                                                 FontSize="13"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Última Modificación" Width="200">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="&#xE787;" 
                                                     FontFamily="Segoe MDL2 Assets"
                                                     FontSize="12"
                                                     Foreground="{StaticResource TextSecondary}"
                                                     Margin="0,0,8,0"
                                                     VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding lastModified, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" 
                                                     Foreground="{StaticResource TextSecondary}"
                                                     FontSize="13"
                                                     VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>